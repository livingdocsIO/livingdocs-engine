require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(){"use strict";function a(){}function c(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function d(a){return function(){return this[a].apply(this,arguments)}}var e=a.prototype,f=this,g=f.EventEmitter;e.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},e.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},e.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},e.addListener=function(a,b){var d,e=this.getListenersAsObject(a),f="object"==typeof b;for(d in e)e.hasOwnProperty(d)&&-1===c(e[d],b)&&e[d].push(f?b:{listener:b,once:!1});return this},e.on=d("addListener"),e.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},e.once=d("addOnceListener"),e.defineEvent=function(a){return this.getListeners(a),this},e.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},e.removeListener=function(a,b){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=c(f[e],b),-1!==d&&f[e].splice(d,1));return this},e.off=d("removeListener"),e.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},e.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},e.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},e.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},e.removeAllListeners=d("removeEvent"),e.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},e.trigger=d("emitEvent"),e.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},e.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return f.EventEmitter=g,a},"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof b&&b.exports?b.exports=a:this.EventEmitter=a}).call(this)},{}],2:[function(a,b){var c,d,e,f,g,h,i,j;g=a("./modules/logging/assert"),h=a("./configuration/defaults"),d=a("./document"),f=a("./snippet_tree/snippet_tree"),c=a("./design/design"),i=a("./design/design_cache"),e=a("./rendering_container/editor_page"),b.exports=j=function(){var a;return a=new e,{"new":function(a){var b,c,d,e,h;return b=a.data,c=a.design,e=null!=b?(d=null!=(h=b.design)?h.name:void 0,g(null!=d,"Error creating document: No design is specified."),c=this.design.get(d),new f({content:b,design:c})):(d=c,c=this.design.get(d),new f({design:c})),this.create(e)},create:function(a){return new d({snippetTree:a})},design:i,startDrag:$.proxy(a,"startDrag"),config:function(a){return $.extend(!0,h,a)}}}(),window.doc=j},{"./configuration/defaults":3,"./design/design":4,"./design/design_cache":5,"./document":7,"./modules/logging/assert":19,"./rendering_container/editor_page":28,"./snippet_tree/snippet_tree":35}],3:[function(a,b){var c,d;b.exports=c=function(){return{loadResources:!0,designPath:"/designs",livingdocsCssFile:"/assets/css/livingdocs.css",wordSeparators:"./\\()\"':,.;<>~!#%^&*|+=[]{}`~?",singleLineBreak:/^<br\s*\/?>\s*$/,zeroWidthCharacter:"ï»¿",attributePrefix:"data",css:{section:"doc-section",snippet:"doc-snippet",editable:"doc-editable",emptyImage:"doc-image-empty","interface":"doc-ui",snippetHighlight:"doc-snippet-highlight",containerHighlight:"doc-container-highlight",dragged:"doc-dragged",draggedPlaceholder:"doc-dragged-placeholder",draggedPlaceholderCounter:"doc-drag-counter",dropMarker:"doc-drop-marker",beforeDrop:"doc-before-drop",noDrop:"doc-drag-no-drop",afterDrop:"doc-after-drop",longpressIndicator:"doc-longpress-indicator",preventSelection:"doc-no-selection",maximizedContainer:"doc-js-maximized-container",interactionBlocker:"doc-interaction-blocker"},attr:{template:"data-doc-template",placeholder:"data-doc-placeholder"},kickstart:{attr:{styles:"doc-styles"}},directives:{container:{attr:"doc-container",renderedAttr:"calculated later",elementDirective:!0,defaultName:"default"},editable:{attr:"doc-editable",renderedAttr:"calculated later",elementDirective:!0,defaultName:"default"},image:{attr:"doc-image",renderedAttr:"calculated later",elementDirective:!0,defaultName:"image"},html:{attr:"doc-html",renderedAttr:"calculated later",elementDirective:!0,defaultName:"default"},optional:{attr:"doc-optional",renderedAttr:"calculated later",elementDirective:!1}},animations:{optionals:{show:function(a){return a.slideDown(250)},hide:function(a){return a.slideUp(250)}}}}}(),d=function(){var a,b,c,d,e;this.docDirective={},this.templateAttrLookup={},d=this.directives,e=[];for(a in d)c=d[a],this.attributePrefix&&(b=""+this.attributePrefix+"-"),c.renderedAttr=""+(b||"")+c.attr,this.docDirective[a]=c.renderedAttr,e.push(this.templateAttrLookup[c.attr]=a);return e},d.call(c)},{}],4:[function(a,b){var c,d,e,f,g;f=a("../modules/logging/assert"),g=a("../modules/logging/log"),e=a("../template/template"),d=a("./design_style"),b.exports=c=function(){function a(a){var b,c,d;d=a.templates||a.snippets,b=a.config,c=a.config.groups||a.groups,this.namespace=(null!=b?b.namespace:void 0)||"livingdocs-templates",this.paragraphSnippet=(null!=b?b.paragraph:void 0)||"text",this.css=b.css,this.js=b.js,this.fonts=b.fonts,this.templates=[],this.groups={},this.styles={},this.storeTemplateDefinitions(d),this.globalStyles=this.createDesignStyleCollection(a.config.styles),this.addGroups(c),this.addTemplatesNotInGroups()}return a.prototype.storeTemplateDefinitions=function(a){var b,c,d,e;for(this.templateDefinitions={},e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.templateDefinitions[b.id]=b);return e},a.prototype.add=function(a,b){var c,d,f;return this.templateDefinitions[a.id]=void 0,d=this.createDesignStyleCollection(a.styles),f=$.extend({},b,d),c=new e({namespace:this.namespace,id:a.id,title:a.title,styles:f,html:a.html,weight:a.sortOrder||0}),this.templates.push(c),c},a.prototype.addGroups=function(a){var b,c,d,e,f,h,i,j,k,l,m,n;n=[];for(c in a){for(b=a[c],d=this.createDesignStyleCollection(b.styles),e=$.extend({},this.globalStyles,d),j={},m=b.templates,k=0,l=m.length;l>k;k++)i=m[k],h=this.templateDefinitions[i],h?(f=this.add(h,e),j[f.id]=f):g.warn("The template '"+i+"' referenced in the group '"+c+"' does not exist.");n.push(this.addGroup(c,b,j))}return n},a.prototype.addTemplatesNotInGroups=function(){var a,b,c,d;c=this.templateDefinitions,d=[];for(b in c)a=c[b],d.push(a?this.add(a,this.globalStyles):void 0);return d},a.prototype.addGroup=function(a,b,c){return this.groups[a]={title:b.title,templates:c}},a.prototype.createDesignStyleCollection=function(a){var b,c,d,e,f;if(c={},a)for(e=0,f=a.length;f>e;e++)d=a[e],b=this.createDesignStyle(d),b&&(c[b.name]=b);return c},a.prototype.createDesignStyle=function(a){return a&&a.name?new d({name:a.name,type:a.type,options:a.options,value:a.value}):void 0},a.prototype.remove=function(a){return this.checkNamespace(a,function(a){return function(b){return a.templates.splice(a.getIndex(b),1)}}(this))},a.prototype.get=function(a){return this.checkNamespace(a,function(a){return function(b){var c;return c=void 0,a.each(function(a){return a.id===b?c=a:void 0}),c}}(this))},a.prototype.getIndex=function(a){return this.checkNamespace(a,function(a){return function(b){var c;return c=void 0,a.each(function(a,d){return a.id===b?c=d:void 0}),c}}(this))},a.prototype.checkNamespace=function(a,b){var c,d,g;return g=e.parseIdentifier(a),d=g.namespace,c=g.id,f(!d||this.namespace===d,"design "+this.namespace+": cannot get template with different namespace "+d+" "),b(c)},a.prototype.each=function(a){var b,c,d,e,f,g;for(f=this.templates,g=[],b=d=0,e=f.length;e>d;b=++d)c=f[b],g.push(a(c,b));return g},a.prototype.list=function(){var a;return a=[],this.each(function(b){return a.push(b.identifier)}),a},a.prototype.info=function(a){var b;return b=this.get(a),b.printDoc()},a}()},{"../modules/logging/assert":19,"../modules/logging/log":20,"../template/template":41,"./design_style":6}],5:[function(a,b){var c,d;d=a("../modules/logging/assert"),c=a("./design"),b.exports=function(){return{designs:{},load:function(a){var b,e;return"string"==typeof a?d(!1,"Load design by name is not implemented yet."):(e=a,b=new c(e),this.add(b))},add:function(a){var b;return b=a.namespace,this.designs[b]=a},has:function(a){return null!=this.designs[a]},get:function(a){return d(this.has(a),"Error: design '"+a+"' is not loaded."),this.designs[a]},resetCache:function(){return this.designs={}}}}()},{"../modules/logging/assert":19,"./design":4}],6:[function(a,b){var c,d,e;e=a("../modules/logging/log"),d=a("../modules/logging/assert"),b.exports=c=function(){function a(a){var b,c;switch(this.name=a.name,this.type=a.type,c=a.value,b=a.options,this.type){case"option":d(c,"TemplateStyle error: no 'value' provided"),this.value=c;break;case"select":d(b,"TemplateStyle error: no 'options' provided"),this.options=b;break;default:e.error("TemplateStyle error: unknown type '"+this.type+"'")}}return a.prototype.cssClassChanges=function(a){if(this.validateValue(a)){if("option"===this.type)return{remove:a?void 0:[this.value],add:a};if("select"===this.type)return{remove:this.otherClasses(a),add:a}}else{if("option"===this.type)return{remove:currentValue,add:void 0};if("select"===this.type)return{remove:this.otherClasses(void 0),add:void 0}}},a.prototype.validateValue=function(a){return a?"option"===this.type?a===this.value:"select"===this.type?this.containsOption(a):e.warn("Not implemented: DesignStyle#validateValue() for type "+this.type):!0},a.prototype.containsOption=function(a){var b,c,d,e;for(e=this.options,c=0,d=e.length;d>c;c++)if(b=e[c],a===b.value)return!0;return!1},a.prototype.otherOptions=function(a){var b,c,d,e,f;for(c=[],f=this.options,d=0,e=f.length;e>d;d++)b=f[d],b.value!==a&&c.push(b);return c},a.prototype.otherClasses=function(a){var b,c,d,e,f;for(c=[],f=this.options,d=0,e=f.length;e>d;d++)b=f[d],b.value!==a&&c.push(b.value);return c},a}()},{"../modules/logging/assert":19,"../modules/logging/log":20}],7:[function(a,b){var c,d,e,f,g,h,i,j,k,l={}.hasOwnProperty,m=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};j=a("./modules/logging/assert"),h=a("./rendering_container/rendering_container"),f=a("./rendering_container/page"),e=a("./rendering_container/interactive_page"),g=a("./rendering/renderer"),i=a("./rendering/view"),d=a("wolfy87-eventemitter"),k=a("./configuration/defaults"),b.exports=c=function(a){function b(a){var b;b=a.snippetTree,this.design=b.design,this.setSnippetTree(b),this.views={},this.interactiveView=void 0}return m(b,a),b.prototype.setSnippetTree=function(a){return j(a.design===this.design,"SnippetTree must have the same design as the document"),this.model=this.snippetTree=a,this.forwardSnippetTreeEvents()},b.prototype.forwardSnippetTreeEvents=function(){return this.snippetTree.changed.add(function(a){return function(){return a.emit("change",arguments)}}(this))},b.prototype.createView=function(a,b){var c,d,e;return null==a&&(a=window.document.body),null==b&&(b={readOnly:!0}),c=$(a).first(),b.$wrapper=this.findWrapper(c),c.html(""),e=new i(this.snippetTree,c[0]),d=e.create(b),e.isInteractive&&this.setInteractiveView(e),d},b.prototype.findWrapper=function(a){var b;return 1===a.find("."+k.css.section).length&&(b=$(a.html())),b},b.prototype.setInteractiveView=function(a){return j(null==this.interactiveView,"Error creating interactive view: Document can have only one interactive view"),this.interactiveView=a},b.prototype.toHtml=function(){return new g({snippetTree:this.snippetTree,renderingContainer:new h}).html()},b.prototype.serialize=function(){return this.snippetTree.serialize()},b.prototype.toJson=function(a){var b,c,d;return b=this.serialize(),null!=a?(c=null,d=2,JSON.stringify(b,c,d)):JSON.stringify(b)},b.prototype.printModel=function(){return this.snippetTree.print()},b}(d)},{"./configuration/defaults":3,"./modules/logging/assert":19,"./rendering/renderer":24,"./rendering/view":26,"./rendering_container/interactive_page":29,"./rendering_container/page":30,"./rendering_container/rendering_container":31,"wolfy87-eventemitter":1}],8:[function(a,b){var c,d;c=a("../configuration/defaults"),d=c.css,b.exports=function(){var a,b;return b=new RegExp("(?: |^)"+d.snippet+"(?: |$)"),a=new RegExp("(?: |^)"+d.section+"(?: |$)"),{findSnippetView:function(a){var c;for(a=this.getElementNode(a);a&&1===a.nodeType;){if(b.test(a.className))return c=this.getSnippetView(a);a=a.parentNode}return void 0},findNodeContext:function(a){var b;for(a=this.getElementNode(a);a&&1===a.nodeType;){if(b=this.getNodeContext(a))return b;a=a.parentNode}return void 0},getNodeContext:function(a){var b,d,e,f;f=c.directives;for(d in f)if(e=f[d],e.elementDirective&&(b=e.renderedAttr,a.hasAttribute(b)))return{contextAttr:b,attrName:a.getAttribute(b)};return void 0},findContainer:function(b){var d,e,f;for(b=this.getElementNode(b),d=c.directives.container.renderedAttr;b&&1===b.nodeType;){if(b.hasAttribute(d))return e=b.getAttribute(d),a.test(b.className)||(f=this.findSnippetView(b)),{node:b,containerName:e,snippetView:f};b=b.parentNode}return{}},getImageName:function(a){var b,d;return b=c.directives.image.renderedAttr,a.hasAttribute(b)?d=a.getAttribute(b):void 0},getHtmlElementName:function(a){var b,d;return b=c.directives.html.renderedAttr,a.hasAttribute(b)?d=a.getAttribute(b):void 0},getEditableName:function(a){var b,d;return b=c.directives.editable.renderedAttr,a.hasAttribute(b)?(d=a.getAttribute(b),editableName):void 0},dropTarget:function(d,e){var f,g,h,i;for(i=e.top,h=e.left,d=this.getElementNode(d),g=c.directives.container.renderedAttr;d&&1===d.nodeType;){if(d.hasAttribute(g))return f=this.getClosestSnippet(d,{top:i,left:h}),null!=f?this.getClosestSnippetTarget(f):this.getContainerTarget(d);if(b.test(d.className))return this.getSnippetTarget(d,{top:i,left:h});if(a.test(d.className))return f=this.getClosestSnippet(d,{top:i,left:h}),null!=f?this.getClosestSnippetTarget(f):this.getRootTarget(d);d=d.parentNode}},getSnippetTarget:function(a,b){var c,d,e;return e=b.top,c=b.left,d=b.position,{target:"snippet",snippetView:this.getSnippetView(a),position:d||this.getPositionOnSnippet(a,{top:e,left:c})}},getClosestSnippetTarget:function(a){var b,c;return b=a.$elem[0],c=a.position,this.getSnippetTarget(b,{position:c})},getContainerTarget:function(a){var b,d;return b=c.directives.container.renderedAttr,d=a.getAttribute(b),{target:"container",node:a,snippetView:this.findSnippetView(a),containerName:d}},getRootTarget:function(a){var b;return b=$(a).data("snippetTree"),{target:"root",node:a,snippetTree:b}},getPositionOnSnippet:function(a,b){var c,d,e,f,g,h;return h=b.top,g=b.left,c=$(a),f=c.offset().top,e=c.outerHeight(),d=f+e,this.distance(h,f)<this.distance(h,d)?"before":"after"},getClosestSnippet:function(a,b){var c,e,f,g,h;return h=b.top,g=b.left,c=$(a).find("."+d.snippet),e=void 0,f=void 0,c.each(function(a){return function(b,c){var d,g,i,j;return d=$(c),j=d.offset().top,i=d.outerHeight(),g=j+i,(null==e||a.distance(h,j)<e)&&(e=a.distance(h,j),f={$elem:d,position:"before"}),null==e||a.distance(h,g)<e?(e=a.distance(h,g),f={$elem:d,position:"after"}):void 0}}(this)),f},distance:function(a,b){return a>b?a-b:b-a},maximizeContainerHeight:function(a){var b,c,e,f,g,h,i,j;if(a.template.containerCount>1){i=a.containers,j=[];for(f in i)e=i[f],b=$(e),b.hasClass(d.maximizedContainer)||(c=b.parent(),h=c.height(),g=b.outerHeight(!0)-b.height(),b.height(h-g),j.push(b.addClass(d.maximizedContainer)));return j}},restoreContainerHeight:function(){return $("."+d.maximizedContainer).css("height","").removeClass(d.maximizedContainer)},getElementNode:function(a){return(null!=a?a.jquery:void 0)?a[0]:3===(null!=a?a.nodeType:void 0)?a.parentNode:a},getSnippetView:function(a){return $(a).data("snippet")},getAbsoluteBoundingClientRect:function(a){var b,c,d,e,f;return e=a.ownerDocument.defaultView,f=this.getScrollPosition(e),c=f.scrollX,d=f.scrollY,b=a.getBoundingClientRect(),b={top:b.top+d,bottom:b.bottom+d,left:b.left+c,right:b.right+c},b.height=b.bottom-b.top,b.width=b.right-b.left,b},getScrollPosition:function(a){return{scrollX:void 0!==a.pageXOffset?a.pageXOffset:(a.document.documentElement||a.document.body.parentNode||a.document.body).scrollLeft,scrollY:void 0!==a.pageYOffset?a.pageYOffset:(a.document.documentElement||a.document.body.parentNode||a.document.body).scrollTop}}}}()},{"../configuration/defaults":3}],9:[function(a,b){var c,d;d=a("../configuration/defaults"),b.exports=c=function(){function a(a,b){var c;this.page=a,this.modes=["direct","longpress","move"],c={preventDefault:!1,onDragStart:void 0,scrollArea:50,longpress:{showIndicator:!0,delay:400,tolerance:3},move:{distance:0}},this.defaultConfig=$.extend(!0,c,b),this.startPoint=void 0,this.dragHandler=void 0,this.initialized=!1,this.started=!1}return a.prototype.setOptions=function(a){return this.options=$.extend(!0,{},this.defaultConfig,a),this.mode=null!=a.direct?"direct":null!=a.longpress?"longpress":null!=a.move?"move":"longpress"},a.prototype.setDragHandler=function(a){return this.dragHandler=a,this.dragHandler.page=this.page},a.prototype.init=function(a,b,c){return this.reset(),this.initialized=!0,this.setOptions(c),this.setDragHandler(a),this.startPoint=this.getEventPosition(b),this.addStopListeners(b),this.addMoveListeners(b),"longpress"===this.mode?(this.addLongpressIndicator(this.startPoint),this.timeout=setTimeout(function(a){return function(){return a.removeLongpressIndicator(),a.start(b)}}(this),this.options.longpress.delay)):"direct"===this.mode&&this.start(b),this.options.preventDefault?b.preventDefault():void 0},a.prototype.move=function(a){var b;if(b=this.getEventPosition(a),"longpress"===this.mode){if(this.distance(b,this.startPoint)>this.options.longpress.tolerance)return this.reset()}else if("move"===this.mode&&this.distance(b,this.startPoint)>this.options.move.distance)return this.start(a)},a.prototype.start=function(a){var b;return b=this.getEventPosition(a),this.started=!0,this.addBlocker(),this.page.$body.addClass(d.css.preventSelection),this.dragHandler.start(b)},a.prototype.drop=function(){return this.started&&this.dragHandler.drop(),this.reset()},a.prototype.reset=function(){return this.started&&(this.started=!1,this.page.$body.removeClass(d.css.preventSelection)),this.initialized?(this.initialized=!1,this.startPoint=void 0,this.dragHandler.reset(),this.dragHandler=void 0,null!=this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.page.$document.off(".livingdocs-drag"),this.removeLongpressIndicator(),this.removeBlocker()):void 0},a.prototype.addBlocker=function(){var a;return a=$("<div class='dragBlocker'>").attr("style","position: absolute; top: 0; bottom: 0; left: 0; right: 0;"),this.page.$body.append(a)},a.prototype.removeBlocker=function(){return this.page.$body.find(".dragBlocker").remove()},a.prototype.addLongpressIndicator=function(a){var b,c,e;return c=a.pageX,e=a.pageY,this.options.longpress.showIndicator?(b=$('<div class="'+d.css.longpressIndicator+'"><div></div></div>'),b.css({left:c,top:e}),this.page.$body.append(b)):void 0},a.prototype.removeLongpressIndicator=function(){return this.page.$body.find("."+d.css.longpressIndicator).remove()},a.prototype.addStopListeners=function(a){var b;return b="touchstart"===a.type?"touchend.livingdocs-drag touchcancel.livingdocs-drag touchleave.livingdocs-drag":"mouseup.livingdocs-drag",this.page.$document.on(b,function(a){return function(){return a.drop()}}(this))},a.prototype.addMoveListeners=function(a){return"touchstart"===a.type?this.page.$document.on("touchmove.livingdocs-drag",function(a){return function(b){return b.preventDefault(),a.started?a.dragHandler.move(a.getEventPosition(b)):a.move(b)}}(this)):this.page.$document.on("mousemove.livingdocs-drag",function(a){return function(b){return a.started?a.dragHandler.move(a.getEventPosition(b)):a.move(b)}}(this))},a.prototype.getEventPosition=function(a){return("touchstart"===a.type||"touchmove"===a.type)&&(a=a.originalEvent.changedTouches[0]),{clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY}},a.prototype.distance=function(a,b){var c,d;return a&&b?(c=a.pageX-b.pageX,d=a.pageY-b.pageY,Math.sqrt(c*c+d*d)):void 0},a}()},{"../configuration/defaults":3}],10:[function(a,b){var c,d,e,f=[].slice;e=a("./dom"),d=a("../configuration/defaults"),b.exports=c=function(){function a(a){this.page=a,this.editable=new Editable({window:this.page.window}),this.editableAttr=d.directives.editable.renderedAttr,this.selection=$.Callbacks(),this.editable.focus(this.withContext(this.focus)).blur(this.withContext(this.blur)).insert(this.withContext(this.insert)).merge(this.withContext(this.merge)).split(this.withContext(this.split)).selection(this.withContext(this.selectionChanged)).newline(this.withContext(this.newline))}return a.prototype.add=function(a){return this.editable.add(a)},a.prototype.disableAll=function(){return this.editable.suspend()},a.prototype.reenableAll=function(){return this.editable["continue"]()},a.prototype.withContext=function(a){return function(b){return function(){var c,d,g,h;return g=arguments[0],c=2<=arguments.length?f.call(arguments,1):[],h=e.findSnippetView(g),d=g.getAttribute(b.editableAttr),c.unshift(h,d),a.apply(b,c)}}(this)},a.prototype.updateModel=function(a,b){var c;return c=a.get(b),(d.singleLineBreak.test(c)||""===c)&&(c=void 0),a.model.set(b,c)},a.prototype.focus=function(a,b){var c;return a.focusEditable(b),c=a.getDirectiveElement(b),this.page.focus.editableFocused(c,a),!0},a.prototype.blur=function(a,b){var c;return a.blurEditable(b),c=a.getDirectiveElement(b),this.page.focus.editableBlurred(c,a),this.updateModel(a,b),!0},a.prototype.insert=function(a,b,c){var d,e,f,g;return this.hasSingleEditable(a)&&(f=this.page.design.paragraphSnippet,g=this.page.design.get(f),d=g.createModel(),e="before"===c?(a.model.before(d),a.prev()):(a.model.after(d),a.next()),e&&e.focus()),!1},a.prototype.merge=function(a,b,c,d){var e,f,g,h,i,j,k;if(this.hasSingleEditable(a)&&(i="before"===c?a.prev():a.next(),i&&i.template===a.template)){for(e=a.directives.$getElem(b).contents(),h=this.page.document.createDocumentFragment(),j=0,k=e.length;k>j;j++)f=e[j],h.appendChild(f);i.focus(),g=i.getDirectiveElement(b),d=this.editable.createCursor(g,"before"===c?"end":"beginning"),d["before"===c?"insertAfter":"insertBefore"](h),d.save(),this.updateModel(i,b),d.restore(),a.model.remove(),d.setSelection()}return!1},a.prototype.split=function(a,b,c,d){var e,f,g;return this.hasSingleEditable(a)&&(g=a.template.createModel(),f=c.querySelector("*").innerHTML,e=d.querySelector("*").innerHTML,a.model.set(b,f),g.set(b,e),a.model.after(g),a.next().focus()),!1},a.prototype.selectionChanged=function(a,b,c){var d;return d=a.getDirectiveElement(b),this.selection.fire(a,d,c)},a.prototype.newline=function(){return!1},a.prototype.hasSingleEditable=function(a){return 1===a.directives.length&&"editable"===a.directives[0].type},a}()},{"../configuration/defaults":3,"./dom":8}],11:[function(a,b){var c,d;d=a("./dom"),b.exports=c=function(){function a(){this.editableNode=void 0,this.snippetView=void 0,this.snippetFocus=$.Callbacks(),this.snippetBlur=$.Callbacks()}return a.prototype.setFocus=function(a,b){return b!==this.editableNode&&(this.resetEditable(),this.editableNode=b),a!==this.snippetView&&(this.resetSnippetView(),a)?(this.snippetView=a,this.snippetFocus.fire(this.snippetView)):void 0},a.prototype.editableFocused=function(a,b){return this.editableNode!==a?(b||(b=d.findSnippetView(a)),this.setFocus(b,a)):void 0},a.prototype.editableBlurred=function(a){return this.editableNode===a?this.setFocus(this.snippetView,void 0):void 0},a.prototype.snippetFocused=function(a){return this.snippetView!==a?this.setFocus(a,void 0):void 0},a.prototype.blur=function(){return this.setFocus(void 0,void 0)},a.prototype.resetEditable=function(){return this.editableNode?this.editableNode=void 0:void 0},a.prototype.resetSnippetView=function(){var a;return this.snippetView?(a=this.snippetView,this.snippetView=void 0,this.snippetBlur.fire(a)):void 0},a}()},{"./dom":8}],12:[function(a,b){var c,d,e,f,g;f=a("./dom"),g=a("../modules/feature_detection/is_supported"),d=a("../configuration/defaults"),e=d.css,b.exports=c=function(){function a(a){var b;this.snippetModel=a.snippetModel,b=a.snippetView,b&&(this.$view=b.$html),this.$highlightedContainer={}}var b,c;return c=0,b=0,a.prototype.start=function(a){return this.started=!0,this.page.editableController.disableAll(),this.page.blurFocusedElement(),this.$placeholder=this.createPlaceholder().css({"pointer-events":"none"}),this.$dragBlocker=this.page.$body.find(".dragBlocker"),this.$dropMarker=$("<div class='"+e.dropMarker+"'>"),this.page.$body.append(this.$dropMarker).append(this.$placeholder).css("cursor","pointer"),null!=this.$view&&this.$view.addClass(e.dragged),this.move(a)},a.prototype.move=function(a){return this.$placeholder.css({left:""+a.pageX+"px",top:""+a.pageY+"px"}),this.target=this.findDropTarget(a)},a.prototype.findDropTarget=function(a){var b,c,d,g,h;return g=this.getElemUnderCursor(a),a=g.eventPosition,c=g.elem,null==c?void 0:c===this.$dropMarker[0]?this.target:(b={left:a.pageX,top:a.pageY},null!=c&&(d=f.dropTarget(c,b)),this.undoMakeSpace(),null!=d&&(null!=(h=d.snippetView)?h.model:void 0)!==this.snippetModel?(this.$placeholder.removeClass(e.noDrop),this.markDropPosition(d),d):(this.$dropMarker.hide(),this.removeContainerHighlight(),void(null==d?this.$placeholder.addClass(e.noDrop):this.$placeholder.removeClass(e.noDrop))))},a.prototype.markDropPosition=function(a){switch(a.target){case"snippet":return this.snippetPosition(a),this.removeContainerHighlight();case"container":return this.showMarkerAtBeginningOfContainer(a.node),this.highlighContainer($(a.node));case"root":return this.showMarkerAtBeginningOfContainer(a.node),this.highlighContainer($(a.node))}},a.prototype.snippetPosition=function(a){var b,c;return"before"===a.position?(b=a.snippetView.prev(),null!=b?b.model===this.snippetModel?(a.position="after",this.snippetPosition(a)):this.showMarkerBetweenSnippets(b,a.snippetView):this.showMarkerAtBeginningOfContainer(a.snippetView.$elem[0].parentNode)):(c=a.snippetView.next(),null!=c?c.model===this.snippetModel?(a.position="before",this.snippetPosition(a)):this.showMarkerBetweenSnippets(a.snippetView,c):this.showMarkerAtEndOfContainer(a.snippetView.$elem[0].parentNode))},a.prototype.showMarkerBetweenSnippets=function(a,b){var c,d,e;return c=f.getAbsoluteBoundingClientRect(a.$elem[0]),d=f.getAbsoluteBoundingClientRect(b.$elem[0]),e=d.top>c.bottom?(d.top-c.bottom)/2:0,this.showMarker({left:c.left,top:c.bottom+e,width:c.width})},a.prototype.showMarkerAtBeginningOfContainer=function(a){var c;if(null!=a)return this.makeSpace(a.firstChild,"top"),c=f.getAbsoluteBoundingClientRect(a),this.showMarker({left:c.left,top:c.top+b,width:c.width})},a.prototype.showMarkerAtEndOfContainer=function(a){var c;if(null!=a)return this.makeSpace(a.lastChild,"bottom"),c=f.getAbsoluteBoundingClientRect(a),this.showMarker({left:c.left,top:c.bottom-b,width:c.width})},a.prototype.showMarker=function(a){var b,c,d,e;return c=a.left,d=a.top,e=a.width,null!=this.iframeBox?(b=$(this.iframeBox.window.document.body),d-=b.scrollTop(),c-=b.scrollLeft(),c+=this.iframeBox.left,d+=this.iframeBox.top,this.$dropMarker.css({position:"fixed"})):this.$dropMarker.css({position:"absolute"}),this.$dropMarker.css({left:""+c+"px",top:""+d+"px",width:""+e+"px"}).show()},a.prototype.makeSpace=function(a,b){var d;if(c&&null!=a)return d=$(a),this.lastTransform=d,d.css("top"===b?{transform:"translate(0, "+c+"px)"}:{transform:"translate(0, -"+c+"px)"})},a.prototype.undoMakeSpace=function(){return null!=this.lastTransform?(this.lastTransform.css({transform:""}),this.lastTransform=void 0):void 0},a.prototype.highlighContainer=function(a){var b,c;return a[0]!==this.$highlightedContainer[0]?("function"==typeof(b=this.$highlightedContainer).removeClass&&b.removeClass(e.containerHighlight),this.$highlightedContainer=a,"function"==typeof(c=this.$highlightedContainer).addClass?c.addClass(e.containerHighlight):void 0):void 0},a.prototype.removeContainerHighlight=function(){var a;return"function"==typeof(a=this.$highlightedContainer).removeClass&&a.removeClass(e.containerHighlight),this.$highlightedContainer={}},a.prototype.getElemUnderCursor=function(a){var b;return b=void 0,this.unblockElementFromPoint(function(c){return function(){var d,e,f;return d=a.clientX,e=a.clientY,b=c.page.document.elementFromPoint(d,e),"IFRAME"===(null!=b?b.nodeName:void 0)?(f=c.findElemInIframe(b,a),a=f.eventPosition,b=f.elem,f):c.iframeBox=void 0}}(this)),{eventPosition:a,elem:b}},a.prototype.findElemInIframe=function(a,b){var c,d,e,f;return this.iframeBox=d=a.getBoundingClientRect(),this.iframeBox.window=a.contentWindow,e=a.contentDocument,c=$(e.body),b.clientX-=d.left,b.clientY-=d.top,b.pageX=b.clientX+c.scrollLeft(),b.pageY=b.clientY+c.scrollTop(),f=e.elementFromPoint(b.clientX,b.clientY),{eventPosition:b,elem:f}},a.prototype.unblockElementFromPoint=function(a){return g("htmlPointerEvents")?(this.$dragBlocker.css({"pointer-events":"none"}),a(),this.$dragBlocker.css({"pointer-events":"auto"})):(this.$dragBlocker.hide(),this.$placeholder.hide(),a(),this.$dragBlocker.show(),this.$placeholder.show())},a.prototype.drop=function(){return null!=this.target?(this.moveToTarget(this.target),this.page.snippetWasDropped.fire(this.snippetModel)):void 0},a.prototype.moveToTarget=function(a){var b,c,d;switch(a.target){case"snippet":return d=a.snippetView,"before"===a.position?d.model.before(this.snippetModel):d.model.after(this.snippetModel);case"container":return b=a.snippetView.model,b.append(a.containerName,this.snippetModel);case"root":return c=a.snippetTree,c.prepend(this.snippetModel)}},a.prototype.reset=function(){return this.started?(this.undoMakeSpace(),this.removeContainerHighlight(),this.page.$body.css("cursor",""),this.page.editableController.reenableAll(),null!=this.$view&&this.$view.removeClass(e.dragged),f.restoreContainerHeight(),this.$placeholder.remove(),this.$dropMarker.remove()):void 0},a.prototype.createPlaceholder=function(){var a,b,c;return b=1,c='<div class="'+e.draggedPlaceholder+'">\n  <span class="'+e.draggedPlaceholderCounter+'">\n    '+b+"\n  </span>\n  Selected Item\n</div>",a=$(c).css({position:"absolute"})},a}()},{"../configuration/defaults":3,"../modules/feature_detection/is_supported":17,"./dom":8}],xmldom:[function(a,b){b.exports=a("BBz8zn")},{}],BBz8zn:[function(a,b,c){var d;c.DOMParser=d=function(){function a(){}return a.prototype.parseFromString=function(a){return $.parseXML(a)},a}(),c.XMLSerializer=XMLSerializer},{}],15:[function(a,b){var c=[].slice;
b.exports=function(){return{callOnce:function(a,b){var d;return d=function(){var e;return e=1<=arguments.length?c.call(arguments,0):[],a.remove(d),b.apply(this,e)},a.add(d),d}}}()},{}],16:[function(a,b){b.exports=function(){return{htmlPointerEvents:function(){var a;return a=document.createElement("x"),a.style.cssText="pointer-events:auto","auto"===a.style.pointerEvents}}}()},{}],17:[function(a,b){var c,d;c=a("./feature_detects"),d={},b.exports=function(a){var b;return void 0===(b=d[a])?d[a]=Boolean(c[a]()):b}},{"./feature_detects":16}],18:[function(a,b){b.exports=function(){var a,b;return a=b=void 0,{next:function(c){var d;return null==c&&(c="doc"),d=Date.now().toString(32),b===d?a+=1:(a=0,b=d),""+c+"-"+d+a}}}()},{}],19:[function(a,b){var c,d;d=a("./log"),b.exports=c=function(a,b){return a?void 0:d.error(b)}},{"./log":20}],20:[function(a,b){var c,d=[].slice,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};b.exports=c=function(){var a;return a=1<=arguments.length?d.call(arguments,0):[],null!=window.console?(a.length&&"trace"===a[a.length-1]&&(a.pop(),null!=window.console.trace&&window.console.trace()),void window.console.log.apply(window.console,a)):void 0},function(){var a,b;return a=function(a){function b(a){b.__super__.constructor.apply(this,arguments),this.message=a,this.thrownByLivingdocs=!0}return f(b,a),b}(Error),b=function(b,d){if(null==d&&(d="error"),"undefined"!=typeof _rollbar&&null!==_rollbar)_rollbar.push(new Error(b),function(){var a;return"critical"!==d&&"error"!==d||null==(null!=(a=window.console)?a.error:void 0)?c.call(void 0,b):window.console.error.call(window.console,b)});else{if("critical"===d||"error"===d)throw new a(b);c.call(void 0,b)}return void 0},c.debug=function(a){return c.debugDisabled?void 0:b(a,"debug")},c.warn=function(a){return c.warningsDisabled?void 0:b(a,"warning")},c.error=function(a){return b(a,"error")}}()},{}],21:[function(a,b){var c,d;d=a("../modules/logging/assert"),b.exports=c=function(){function a(){this.count=0,this.started=!1,this.wasFired=!1,this.callbacks=[]}return a.prototype.addCallback=function(a){return this.wasFired?a():this.callbacks.push(a)},a.prototype.isReady=function(){return this.wasFired},a.prototype.start=function(){return d(!this.started,"Unable to start Semaphore once started."),this.started=!0,this.fireIfReady()},a.prototype.increment=function(){return d(!this.wasFired,"Unable to increment count once Semaphore is fired."),this.count+=1},a.prototype.decrement=function(){return d(this.count>0,"Unable to decrement count resulting in negative count."),this.count-=1,this.fireIfReady()},a.prototype.wait=function(){return this.increment(),function(a){return function(){return a.decrement()}}(this)},a.prototype.fireIfReady=function(){var a,b,c,d,e;if(0===this.count&&this.started===!0){for(this.wasFired=!0,d=this.callbacks,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a());return e}},a}()},{"../modules/logging/assert":19}],22:[function(a,b){b.exports=function(){return{isEmpty:function(a){var b;if(null==a)return!0;for(b in a)if(a.hasOwnProperty(b))return!1;return!0},flatCopy:function(a){var b,c,d;b=void 0;for(c in a)d=a[c],b||(b={}),b[c]=d;return b}}}()},{}],23:[function(a,b){b.exports=function(){return{humanize:function(a){var b;return b=$.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1 $2").toLowerCase(),this.titleize(b)},capitalize:function(a){return a=null==a?"":String(a),a.charAt(0).toUpperCase()+a.slice(1)},titleize:function(a){return null==a?"":String(a).replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},snakeCase:function(a){return $.trim(a).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},prefix:function(a,b){return 0===b.indexOf(a)?b:""+a+b},readableJson:function(a){return JSON.stringify(a,null,2)},camelize:function(a){return $.trim(a).replace(/[-_\s]+(.)?/g,function(a,b){return b.toUpperCase()})},trim:function(a){return a.replace(/^\s+|\s+$/g,"")}}}()},{}],24:[function(a,b){var c,d,e,f,g;e=a("../modules/logging/assert"),g=a("../modules/logging/log"),d=a("../modules/semaphore"),f=a("../configuration/defaults"),b.exports=c=function(){function a(a){var b;this.snippetTree=a.snippetTree,this.renderingContainer=a.renderingContainer,b=a.$wrapper,e(this.snippetTree,"no snippet tree specified"),e(this.renderingContainer,"no rendering container specified"),this.$root=$(this.renderingContainer.renderNode),this.$wrapperHtml=b,this.snippetViews={},this.readySemaphore=new d,this.renderOncePageReady(),this.readySemaphore.start()}return a.prototype.setRoot=function(){var a,b,c;if((null!=(c=this.$wrapperHtml)?c.length:void 0)&&this.$wrapperHtml.jquery){if(b="."+f.css.section,a=this.$wrapperHtml.find(b).add(this.$wrapperHtml.filter(b)),!a.length)return;return this.$wrapper=this.$root,this.$wrapper.append(this.$wrapperHtml),this.$root=a}},a.prototype.renderOncePageReady=function(){return this.readySemaphore.increment(),this.renderingContainer.ready(function(a){return function(){return a.setRoot(),a.render(),a.setupSnippetTreeListeners(),a.readySemaphore.decrement()}}(this))},a.prototype.ready=function(a){return this.readySemaphore.addCallback(a)},a.prototype.isReady=function(){return this.readySemaphore.isReady()},a.prototype.html=function(){return e(this.isReady(),"Cannot generate html. Renderer is not ready."),this.renderingContainer.html()},a.prototype.setupSnippetTreeListeners=function(){return this.snippetTree.snippetAdded.add($.proxy(this.snippetAdded,this)),this.snippetTree.snippetRemoved.add($.proxy(this.snippetRemoved,this)),this.snippetTree.snippetMoved.add($.proxy(this.snippetMoved,this)),this.snippetTree.snippetContentChanged.add($.proxy(this.snippetContentChanged,this)),this.snippetTree.snippetHtmlChanged.add($.proxy(this.snippetHtmlChanged,this))},a.prototype.snippetAdded=function(a){return this.insertSnippet(a)},a.prototype.snippetRemoved=function(a){return this.removeSnippet(a),this.deleteCachedSnippetViewForSnippet(a)},a.prototype.snippetMoved=function(a){return this.removeSnippet(a),this.insertSnippet(a)},a.prototype.snippetContentChanged=function(a){return this.snippetViewForSnippet(a).updateContent()},a.prototype.snippetHtmlChanged=function(a){return this.snippetViewForSnippet(a).updateHtml()},a.prototype.snippetViewForSnippet=function(a){var b,c;return(b=this.snippetViews)[c=a.id]||(b[c]=a.createView(this.renderingContainer.isReadOnly))},a.prototype.deleteCachedSnippetViewForSnippet=function(a){return delete this.snippetViews[a.id]},a.prototype.render=function(){return this.snippetTree.each(function(a){return function(b){return a.insertSnippet(b)}}(this))},a.prototype.clear=function(){return this.snippetTree.each(function(a){return function(b){return a.snippetViewForSnippet(b).setAttachedToDom(!1)}}(this)),this.$root.empty()},a.prototype.redraw=function(){return this.clear(),this.render()},a.prototype.insertSnippet=function(a){var b;if(!this.isSnippetAttached(a))return this.isSnippetAttached(a.previous)?this.insertSnippetAsSibling(a.previous,a):this.isSnippetAttached(a.next)?this.insertSnippetAsSibling(a.next,a):a.parentContainer?this.appendSnippetToParentContainer(a):g.error("Snippet could not be inserted by renderer."),b=this.snippetViewForSnippet(a),b.setAttachedToDom(!0),this.renderingContainer.snippetViewWasInserted(b),this.attachChildSnippets(a)},a.prototype.isSnippetAttached=function(a){return a&&this.snippetViewForSnippet(a).isAttachedToDom},a.prototype.attachChildSnippets=function(a){return a.children(function(a){return function(b){return a.isSnippetAttached(b)?void 0:a.insertSnippet(b)}}(this))},a.prototype.insertSnippetAsSibling=function(a,b){var c;return c=a===b.previous?"after":"before",this.$nodeForSnippet(a)[c](this.$nodeForSnippet(b))},a.prototype.appendSnippetToParentContainer=function(a){return this.$nodeForSnippet(a).appendTo(this.$nodeForContainer(a.parentContainer))},a.prototype.$nodeForSnippet=function(a){return this.snippetViewForSnippet(a).$html},a.prototype.$nodeForContainer=function(a){var b;return a.isRoot?this.$root:(b=this.snippetViewForSnippet(a.parentSnippet),$(b.getDirectiveElement(a.name)))},a.prototype.removeSnippet=function(a){return this.snippetViewForSnippet(a).setAttachedToDom(!1),this.$nodeForSnippet(a).detach()},a}()},{"../configuration/defaults":3,"../modules/logging/assert":19,"../modules/logging/log":20,"../modules/semaphore":21}],25:[function(a,b){var c,d,e,f,g,h,i;f=a("../configuration/defaults"),g=f.css,e=f.attr,c=a("../template/directive_iterator"),i=a("../modules/eventing"),h=a("../interaction/dom"),b.exports=d=function(){function a(a){this.model=a.model,this.$html=a.$html,this.directives=a.directives,this.isReadOnly=a.isReadOnly,this.$elem=this.$html,this.template=this.model.template,this.isAttachedToDom=!1,this.wasAttachedToDom=$.Callbacks(),this.isReadOnly||this.$html.data("snippet",this).addClass(g.snippet).attr(e.template,this.template.identifier),this.render()}return a.prototype.render=function(){return this.updateContent(),this.updateHtml()},a.prototype.updateContent=function(){return this.content(this.model.content),this.hasFocus()||this.displayOptionals(),this.stripHtmlIfReadOnly()},a.prototype.updateHtml=function(){var a,b,c;c=this.model.styles;for(a in c)b=c[a],this.style(a,b);return this.stripHtmlIfReadOnly()},a.prototype.displayOptionals=function(){return this.directives.each(function(a){return function(b){var c;return b.optional?(c=$(b.elem),a.model.isEmpty(b.name)?c.css("display","none"):c.css("display","")):void 0}}(this))},a.prototype.showOptionals=function(){return this.directives.each(function(){return function(a){return a.optional?f.animations.optionals.show($(a.elem)):void 0}}(this))},a.prototype.hideEmptyOptionals=function(){return this.directives.each(function(a){return function(b){return b.optional&&a.model.isEmpty(b.name)?f.animations.optionals.hide($(b.elem)):void 0}}(this))},a.prototype.next=function(){return this.$html.next().data("snippet")},a.prototype.prev=function(){return this.$html.prev().data("snippet")},a.prototype.afterFocused=function(){return this.$html.addClass(g.snippetHighlight),this.showOptionals()},a.prototype.afterBlurred=function(){return this.$html.removeClass(g.snippetHighlight),this.hideEmptyOptionals()},a.prototype.focus=function(){var a,b;return a=null!=(b=this.directives.editable)?b[0].elem:void 0,$(a).focus()},a.prototype.hasFocus=function(){return this.$html.hasClass(g.snippetHighlight)},a.prototype.getBoundingClientRect=function(){return this.$html[0].getBoundingClientRect()},a.prototype.getAbsoluteBoundingClientRect=function(){return h.getAbsoluteBoundingClientRect(this.$html[0])},a.prototype.content=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this.set(b,c));return d},a.prototype.set=function(a,b){var c;switch(c=this.directives.get(a),c.type){case"editable":return this.setEditable(a,b);case"image":return this.setImage(a,b);case"html":return this.setHtml(a,b)}},a.prototype.get=function(a){var b;switch(b=this.directives.get(a),b.type){case"editable":return this.getEditable(a);case"image":return this.getImage(a);case"html":return this.getHtml(a)}},a.prototype.getEditable=function(a){var b;return b=this.directives.$getElem(a),b.html()},a.prototype.setEditable=function(a,b){var c,d;return c=this.directives.$getElem(a),d=b?f.zeroWidthCharacter:this.template.defaults[a],c.attr(e.placeholder,d),c.html(b||"")},a.prototype.focusEditable=function(a){var b;return b=this.directives.$getElem(a),b.attr(e.placeholder,f.zeroWidthCharacter)},a.prototype.blurEditable=function(a){var b;return b=this.directives.$getElem(a),this.model.isEmpty(a)?b.attr(e.placeholder,this.template.defaults[a]):void 0},a.prototype.getHtml=function(a){var b;return b=this.directives.$getElem(a),b.html()},a.prototype.setHtml=function(a,b){var c;return c=this.directives.$getElem(a),c.html(b||""),b?b&&!this.isReadOnly&&this.blockInteraction(c):c.html(this.template.defaults[a]),this.directivesToReset||(this.directivesToReset={}),this.directivesToReset[a]=a},a.prototype.getDirectiveElement=function(a){var b;return null!=(b=this.directives.get(a))?b.elem:void 0},a.prototype.resetDirectives=function(){var a,b,c;c=[];for(b in this.directivesToReset)a=this.directives.$getElem(b),c.push(a.find("iframe").length?this.set(b,this.model.content[b]):void 0);return c},a.prototype.getImage=function(a){var b;return b=this.directives.$getElem(a),b.attr("src")},a.prototype.setImage=function(a,b){var c,d;return c=this.directives.$getElem(a),b?(this.cancelDelayed(a),this.setImageAttribute(c,b),c.removeClass(f.css.emptyImage)):(d=$.proxy(this.setPlaceholderImage,this,c),this.delayUntilAttached(a,d))},a.prototype.setImageAttribute=function(a,b){return"IMG"===a[0].nodeName?a.attr("src",b):a.css("background-image","url("+this.escapeCssUri(b)+")")},a.prototype.escapeCssUri=function(a){return/[()]/.test(a)?"'"+a+"'":a},a.prototype.setPlaceholderImage=function(a){var b,c,d;return a.addClass(f.css.emptyImage),"IMG"===a[0].nodeName?(d=a.width(),b=a.height()):(d=a.outerWidth(),b=a.outerHeight()),c="http://placehold.it/"+d+"x"+b+"/BEF56F/B2E668",this.setImageAttribute(a,c)},a.prototype.style=function(a,b){var c,d,e,f,g;if(c=this.template.styles[a].cssClassChanges(b),c.remove)for(g=c.remove,e=0,f=g.length;f>e;e++)d=g[e],this.$html.removeClass(d);return this.$html.addClass(c.add)},a.prototype.disableTabbing=function(a){return setTimeout(function(){return function(){return a.find("iframe").attr("tabindex","-1")}}(this),400)},a.prototype.blockInteraction=function(a){var b;return this.ensureRelativePosition(a),b=$("<div class='"+g.interactionBlocker+"'>").attr("style","position: absolute; top: 0; bottom: 0; left: 0; right: 0;"),a.append(b),this.disableTabbing(a)},a.prototype.ensureRelativePosition=function(a){var b;return b=a.css("position"),"absolute"!==b&&"fixed"!==b&&"relative"!==b?a.css("position","relative"):void 0},a.prototype.get$container=function(){return $(h.findContainer(this.$html[0]).node)},a.prototype.delayUntilAttached=function(a,b){return this.isAttachedToDom?b():(this.cancelDelayed(a),this.delayed||(this.delayed={}),this.delayed[a]=i.callOnce(this.wasAttachedToDom,function(c){return function(){return c.delayed[a]=void 0,b()}}(this)))},a.prototype.cancelDelayed=function(a){var b;return(null!=(b=this.delayed)?b[a]:void 0)?(this.wasAttachedToDom.remove(this.delayed[a]),this.delayed[a]=void 0):void 0},a.prototype.stripHtmlIfReadOnly=function(){var a,b,d;if(this.isReadOnly){for(b=new c(this.$html[0]),d=[];a=b.nextElement();)this.stripDocClasses(a),this.stripDocAttributes(a),d.push(this.stripEmptyAttributes(a));return d}},a.prototype.stripDocClasses=function(a){var b,c,d,e,f,g;for(b=$(a),f=a.className.split(/\s+/),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(/doc\-.*/i.test(c)?b.removeClass(c):void 0);return g},a.prototype.stripDocAttributes=function(a){var b,c,d,e,f,g,h;for(b=$(a),g=Array.prototype.slice.apply(a.attributes),h=[],e=0,f=g.length;f>e;e++)c=g[e],d=c.name,h.push(/data\-doc\-.*/i.test(d)?b.removeAttr(d):void 0);return h},a.prototype.stripEmptyAttributes=function(a){var b,c,d,e,f,g,h,i,j;for(b=$(a),f=["style","class"],i=Array.prototype.slice.apply(a.attributes),j=[],g=0,h=i.length;h>g;g++)c=i[g],e=f.indexOf(c.name)>=0,d=""===c.value.trim(),j.push(e&&d?b.removeAttr(c.name):void 0);return j},a.prototype.setAttachedToDom=function(a){return a!==this.isAttachedToDom?(this.isAttachedToDom=a,a?(this.resetDirectives(),this.wasAttachedToDom.fire()):void 0):void 0},a}()},{"../configuration/defaults":3,"../interaction/dom":8,"../modules/eventing":15,"../template/directive_iterator":40}],26:[function(a,b){var c,d,e,f;e=a("./renderer"),d=a("../rendering_container/page"),c=a("../rendering_container/interactive_page"),b.exports=f=function(){function a(a,b){this.snippetTree=a,this.parent=b,null==this.parent&&(this.parent=window.document.body),this.isInteractive=!1}return a.prototype.create=function(a){return this.createIFrame(this.parent).then(function(b){return function(c){var d;return d=b.createIFrameRenderer(c,a),{iframe:c,renderer:d}}}(this))},a.prototype.createIFrame=function(a){var b,c;return b=$.Deferred(),c=a.ownerDocument.createElement("iframe"),c.src="about:blank",c.setAttribute("frameBorder","0"),c.onload=function(){return b.resolve(c)},a.appendChild(c),b.promise()},a.prototype.createIFrameRenderer=function(a,b){var c,d;return c={renderNode:a.contentDocument.body,hostWindow:a.contentWindow,design:this.snippetTree.design},this.page=this.createPage(c,b),d=new e({renderingContainer:this.page,snippetTree:this.snippetTree,$wrapper:b.$wrapper})},a.prototype.createPage=function(a,b){var e,f,g;return g=null!=b?b:{},e=g.interactive,f=g.readOnly,null!=e?(this.isInteractive=!0,new c(a)):new d(a)},a}()},{"../rendering_container/interactive_page":29,"../rendering_container/page":30,"./renderer":24}],27:[function(a,b){var c,d;d=a("../modules/semaphore"),b.exports=c=function(){function a(a){this.window=a,this.loadedUrls=[]}return a.prototype.load=function(a,b){var c,e,f,g;for(null==b&&(b=$.noop),$.isArray(a)||(a=[a]),c=new d,c.addCallback(b),f=0,g=a.length;g>f;f++)e=a[f],this.loadSingleUrl(e,c.wait());return c.start()},a.prototype.loadSingleUrl=function(a,b){var c;return null==b&&(b=$.noop),this.isUrlLoaded(a)?b():(c=$('<link rel="stylesheet" type="text/css" />')[0],c.onload=b,c.href=a,this.window.document.head.appendChild(c),this.markUrlAsLoaded(a))},a.prototype.isUrlLoaded=function(a){return this.loadedUrls.indexOf(a)>=0},a.prototype.markUrlAsLoaded=function(a){return this.loadedUrls.push(a)},a}()},{"../modules/semaphore":21}],28:[function(a,b){var c,d,e,f,g;f=a("../configuration/defaults"),g=f.css,c=a("../interaction/drag_base"),e=a("../interaction/snippet_drag"),b.exports=d=function(){function a(){this.setWindow(),this.dragBase=new c(this),this.editableController={disableAll:function(){},reenableAll:function(){}},this.snippetWasDropped={fire:function(){}},this.blurFocusedElement=function(){}}return a.prototype.startDrag=function(a){var b,c,d,f,g;return f=a.snippetModel,g=a.snippetView,c=a.event,b=a.config,f||g?(g&&(f=g.model),d=new e({snippetModel:f,snippetView:g}),null==b&&(b={longpress:{showIndicator:!0,delay:400,tolerance:3}}),this.dragBase.init(d,c,b)):void 0},a.prototype.setWindow=function(){return this.window=window,this.document=this.window.document,this.$document=$(this.document),this.$body=$(this.document.body)},a}()},{"../configuration/defaults":3,"../interaction/drag_base":9,"../interaction/snippet_drag":12}],29:[function(a,b){var c,d,e,f,g,h,i,j,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};i=a("../configuration/defaults"),g=a("./page"),j=a("../interaction/dom"),e=a("../interaction/focus"),d=a("../interaction/editable_controller"),c=a("../interaction/drag_base"),h=a("../interaction/snippet_drag"),b.exports=f=function(a){function b(a){var f,g,h;h=null!=a?a:{},g=h.renderNode,f=h.hostWindow,b.__super__.constructor.apply(this,arguments),this.focus=new e,this.editableController=new d(this),this.imageClick=$.Callbacks(),this.htmlElementClick=$.Callbacks(),this.snippetWillBeDragged=$.Callbacks(),this.snippetWasDropped=$.Callbacks(),this.dragBase=new c(this),this.focus.snippetFocus.add($.proxy(this.afterSnippetFocused,this)),this.focus.snippetBlur.add($.proxy(this.afterSnippetBlurred,this)),this.beforeInteractivePageReady(),this.$document.on("click.livingdocs",$.proxy(this.click,this)).on("mousedown.livingdocs",$.proxy(this.mousedown,this)).on("touchstart.livingdocs",$.proxy(this.mousedown,this)).on("dragstart",$.proxy(this.browserDragStart,this))}var f;return l(b,a),f=1,b.prototype.isReadOnly=!1,b.prototype.beforeInteractivePageReady=function(){return null!=i.livingdocsCssFile?this.cssLoader.load(i.livingdocsCssFile,this.readySemaphore.wait()):void 0},b.prototype.browserDragStart=function(a){return a.preventDefault(),a.stopPropagation()},b.prototype.removeListeners=function(){return this.$document.off(".livingdocs"),this.$document.off(".livingdocs-drag")},b.prototype.mousedown=function(a){var b;if((a.which===f||"mousedown"!==a.type)&&(b=j.findSnippetView(a.target)))return this.startDrag({snippetView:b,event:a})},b.prototype.startDrag=function(a){var b,c,d,e,f;return e=a.snippetModel,f=a.snippetView,c=a.event,b=a.config,e||f?(f&&(e=f.model),d=new h({snippetModel:e,snippetView:f}),null==b&&(b={longpress:{showIndicator:!0,delay:400,tolerance:3}}),this.dragBase.init(d,c,b)):void 0},b.prototype.click=function(a){var b,c;if(c=j.findSnippetView(a.target),b=j.findNodeContext(a.target),!c)return this.focus.blur();if(this.focus.snippetFocused(c),b)switch(b.contextAttr){case i.directives.image.renderedAttr:return this.imageClick.fire(c,b.attrName,a);case i.directives.html.renderedAttr:return this.htmlElementClick.fire(c,b.attrName,a)}},b.prototype.getFocusedElement=function(){return window.document.activeElement},b.prototype.blurFocusedElement=function(){var a;return this.focus.setFocus(void 0),a=this.getFocusedElement(),a?$(a).blur():void 0},b.prototype.snippetViewWasInserted=function(a){return this.initializeEditables(a)},b.prototype.initializeEditables=function(a){var b,c;return a.directives.editable?(c=function(){var c,d,e,f;for(e=a.directives.editable,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.elem);return f}(),this.editableController.add(c)):void 0},b.prototype.afterSnippetFocused=function(a){return a.afterFocused()},b.prototype.afterSnippetBlurred=function(a){return a.afterBlurred()},b}(g)},{"../configuration/defaults":3,"../interaction/dom":8,"../interaction/drag_base":9,"../interaction/editable_controller":10,"../interaction/focus":11,"../interaction/snippet_drag":12,"./page":30}],30:[function(a,b){var c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("./rendering_container"),c=a("./css_loader"),f=a("../configuration/defaults"),b.exports=d=function(a){function b(a){var d,e,f,h;h=null!=a?a:{},f=h.renderNode,e=h.readOnly,d=h.hostWindow,this.design=h.design,this.snippetTree=h.snippetTree,this.beforePageReady=g(this.beforePageReady,this),null!=e&&(this.isReadOnly=e),this.setWindow(d),b.__super__.constructor.call(this),this.setRenderNode(f),$(this.renderNode).data("snippetTree",this.snippetTree),this.cssLoader=new c(this.window),this.beforePageReady()}return i(b,a),b.prototype.setRenderNode=function(a){return null==a&&(a=$("."+f.css.section,this.$body)),this.renderNode=a.jquery?a[0]:a},b.prototype.beforeReady=function(){return this.readySemaphore.wait(),setTimeout(function(a){return function(){return a.readySemaphore.decrement()}}(this),0)},b.prototype.beforePageReady=function(){var a,b,c;return null!=this.design&&f.loadResources?(b=""+f.designPath+"/"+this.design.namespace,a=null!=this.design.css?this.design.css:"/css/style.css",c=""+b+a,this.cssLoader.load(c,this.readySemaphore.wait())):void 0},b.prototype.setWindow=function(a){return this.window=a||window,this.document=this.window.document,this.$document=$(this.document),this.$body=$(this.document.body)},b}(e)},{"../configuration/defaults":3,"./css_loader":27,"./rendering_container":31}],31:[function(a,b){var c,d;d=a("../modules/semaphore"),b.exports=c=function(){function a(){this.renderNode=$("<div/>")[0],this.readySemaphore=new d,this.beforeReady(),this.readySemaphore.start()}return a.prototype.isReadOnly=!0,a.prototype.html=function(){return $(this.renderNode).html()},a.prototype.snippetViewWasInserted=function(){},a.prototype.beforeReady=function(){},a.prototype.ready=function(a){return this.readySemaphore.addCallback(a)},a}()},{"../modules/semaphore":21}],32:[function(a,b){var c;b.exports=c=function(){function a(a){this.snippets=a,null==this.snippets&&(this.snippets=[]),this.createPseudoArray()}return a.prototype.createPseudoArray=function(){var a,b,c,d,e;for(e=this.snippets,a=c=0,d=e.length;d>c;a=++c)b=e[a],this[a]=b;return this.length=this.snippets.length,this.snippets.length?(this.first=this[0],this.last=this[this.snippets.length-1]):void 0},a.prototype.each=function(a){var b,c,d,e;for(e=this.snippets,c=0,d=e.length;d>c;c++)b=e[c],a(b);return this},a.prototype.remove=function(){return this.each(function(a){return a.remove()}),this},a}()},{}],33:[function(a,b){var c,d;d=a("../modules/logging/assert"),b.exports=c=function(){function a(a){var b;this.parentSnippet=a.parentSnippet,this.name=a.name,b=a.isRoot,this.isRoot=null!=b,this.first=this.last=void 0}return a.prototype.prepend=function(a){return this.first?this.insertBefore(this.first,a):this.attachSnippet(a),this},a.prototype.append=function(a){return this.parentSnippet&&d(a!==this.parentSnippet,"cannot append snippet to itself"),this.last?this.insertAfter(this.last,a):this.attachSnippet(a),this},a.prototype.insertBefore=function(a,b){var c;if(a.previous!==b)return d(a!==b,"cannot insert snippet before itself"),c={previous:a.previous,next:a,parentContainer:a.parentContainer},this.attachSnippet(b,c)},a.prototype.insertAfter=function(a,b){var c;if(a.next!==b)return d(a!==b,"cannot insert snippet after itself"),c={previous:a,next:a.next,parentContainer:a.parentContainer},this.attachSnippet(b,c)},a.prototype.up=function(a){return null!=a.previous?this.insertBefore(a.previous,a):void 0},a.prototype.down=function(a){return null!=a.next?this.insertAfter(a.next,a):void 0},a.prototype.getSnippetTree=function(){var a;return this.snippetTree||(null!=(a=this.parentSnippet)?a.snippetTree:void 0)},a.prototype.each=function(a){var b,c;for(b=this.first,c=[];b;)b.descendantsAndSelf(a),c.push(b=b.next);return c},a.prototype.eachContainer=function(a){return a(this),this.each(function(b){var c,d,e,f;e=b.containers,f=[];for(c in e)d=e[c],f.push(a(d));return f})},a.prototype.all=function(a){return a(this),this.each(function(b){var c,d,e,f;a(b),e=b.containers,f=[];for(c in e)d=e[c],f.push(a(d));return f})},a.prototype.remove=function(a){return a.destroy(),this._detachSnippet(a)},a.prototype.ui=function(){var a;return this.uiInjector||(a=this.getSnippetTree(),a.renderer.createInterfaceInjector(this)),this.uiInjector},a.prototype.attachSnippet=function(a,b){var c,d;return null==b&&(b={}),c=function(c){return function(){return c.link(a,b)}}(this),(d=this.getSnippetTree())?d.attachingSnippet(a,c):c()},a.prototype._detachSnippet=function(a){var b,c;return b=function(b){return function(){return b.unlink(a)}}(this),(c=this.getSnippetTree())?c.detachingSnippet(a,b):b()},a.prototype.link=function(a,b){return a.parentContainer&&this.unlink(a),b.parentContainer||(b.parentContainer=this),this.setSnippetPosition(a,b)},a.prototype.unlink=function(a){var b,c,d;return b=a.parentContainer,b?(null==a.previous&&(b.first=a.next),null==a.next&&(b.last=a.previous),null!=(c=a.next)&&(c.previous=a.previous),null!=(d=a.previous)&&(d.next=a.next),this.setSnippetPosition(a,{})):void 0},a.prototype.setSnippetPosition=function(a,b){var c,d,e;return d=b.parentContainer,e=b.previous,c=b.next,a.parentContainer=d,a.previous=e,a.next=c,d&&(e&&(e.next=a),c&&(c.previous=a),null==a.previous&&(d.first=a),null==a.next)?d.last=a:void 0},a}()},{"../modules/logging/assert":19}],34:[function(a,b){var c,d,e,f,g,h,i;f=a("../configuration/defaults"),c=a("./snippet_container"),g=a("../modules/guid"),h=a("../modules/logging/log"),e=a("../modules/logging/assert"),i=a("../modules/serialization"),f=a("../configuration/defaults"),b.exports=d=function(){function a(a){var b,c;c=null!=a?a:{},this.template=c.template,b=c.id,e(this.template,"cannot instantiate snippet without template reference"),this.initializeDirectives(),this.styles={},this.id=b||g.next(),this.identifier=this.template.identifier,this.next=void 0,this.previous=void 0,this.snippetTree=void 0}return a.prototype.initializeDirectives=function(){var a,b,d,e,f;for(e=this.template.directives,f=[],b=0,d=e.length;d>b;b++)switch(a=e[b],a.type){case"container":this.containers||(this.containers={}),f.push(this.containers[a.name]=new c({name:a.name,parentSnippet:this}));break;case"editable":case"image":case"html":this.content||(this.content={}),f.push(this.content[a.name]=void 0);break;default:f.push(h.error("Template directive type '"+a.type+"' not implemented in SnippetModel"))}return f},a.prototype.createView=function(a){return this.template.createView(this,a)},a.prototype.hasContainers=function(){return this.template.directives.count("container")>0},a.prototype.hasEditables=function(){return this.template.directives.count("editable")>0},a.prototype.hasHtml=function(){return this.template.directives.count("html")>0},a.prototype.hasImages=function(){return this.template.directives.count("image")>0},a.prototype.before=function(a){return a?(this.parentContainer.insertBefore(this,a),this):this.previous},a.prototype.after=function(a){return a?(this.parentContainer.insertAfter(this,a),this):this.next},a.prototype.append=function(a,b){return 1===arguments.length&&(b=a,a=f.directives.container.defaultName),this.containers[a].append(b),this},a.prototype.prepend=function(a,b){return 1===arguments.length&&(b=a,a=f.directives.container.defaultName),this.containers[a].prepend(b),this},a.prototype.set=function(a,b){var c;return e(null!=(c=this.content)?c.hasOwnProperty(a):void 0,"set error: "+this.identifier+" has no content named "+a),this.content[a]!==b&&(this.content[a]=b,this.snippetTree)?this.snippetTree.contentChanging(this,a):void 0},a.prototype.get=function(a){var b;return e(null!=(b=this.content)?b.hasOwnProperty(a):void 0,"get error: "+this.identifier+" has no content named "+a),this.content[a]},a.prototype.isEmpty=function(a){var b;return b=this.get(a),void 0===b||""===b},a.prototype.style=function(a,b){return 1===arguments.length?this.styles[a]:this.setStyle(a,b)},a.prototype.setStyle=function(a,b){var c;return c=this.template.styles[a],c?c.validateValue(b)?this.styles[a]!==b&&(this.styles[a]=b,this.snippetTree)?this.snippetTree.htmlChanging(this,"style",{name:a,value:b}):void 0:h.warn("Invalid value '"+b+"' for style '"+a+"' in SnippetModel "+this.identifier):h.warn("Unknown style '"+a+"' in SnippetModel "+this.identifier)},a.prototype.copy=function(){return h.warn("SnippetModel#copy() is not implemented yet.")},a.prototype.copyWithoutContent=function(){return this.template.createModel()},a.prototype.up=function(){return this.parentContainer.up(this),this},a.prototype.down=function(){return this.parentContainer.down(this),this},a.prototype.remove=function(){return this.parentContainer.remove(this)},a.prototype.destroy=function(){return this.uiInjector?this.uiInjector.remove():void 0},a.prototype.getParent=function(){var a;return null!=(a=this.parentContainer)?a.parentSnippet:void 0},a.prototype.ui=function(){return this.uiInjector||this.snippetTree.renderer.createInterfaceInjector(this),this.uiInjector},a.prototype.parents=function(a){var b,c;for(b=this,c=[];b=b.getParent();)c.push(a(b));return c},a.prototype.children=function(a){var b,c,d,e,f;e=this.containers,f=[];for(b in e)c=e[b],d=c.first,f.push(function(){var b;for(b=[];d;)a(d),b.push(d=d.next);return b}());return f},a.prototype.descendants=function(a){var b,c,d,e,f;e=this.containers,f=[];for(b in e)c=e[b],d=c.first,f.push(function(){var b;for(b=[];d;)a(d),d.descendants(a),b.push(d=d.next);return b}());return f},a.prototype.descendantsAndSelf=function(a){return a(this),this.descendants(a)},a.prototype.descendantContainers=function(a){return this.descendantsAndSelf(function(b){var c,d,e,f;e=b.containers,f=[];for(c in e)d=e[c],f.push(a(d));return f})},a.prototype.allDescendants=function(a){return this.descendantsAndSelf(function(b){return function(c){var d,e,f,g;c!==b&&a(c),f=c.containers,g=[];for(d in f)e=f[d],g.push(a(e));return g}}(this))},a.prototype.childrenAndSelf=function(a){return a(this),this.children(a)},a.prototype.toJson=function(){var a,b;
a={id:this.id,identifier:this.identifier},i.isEmpty(this.content)||(a.content=i.flatCopy(this.content)),i.isEmpty(this.styles)||(a.styles=i.flatCopy(this.styles));for(b in this.containers)a.containers||(a.containers={}),a.containers[b]=[];return a},a}(),d.fromJson=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q;k=b.get(a.identifier),e(k,"error while deserializing snippet: unknown template identifier '"+a.identifier+"'"),g=new d({template:k,id:a.id}),o=a.content;for(h in o)l=o[h],e(g.content.hasOwnProperty(h),"error while deserializing snippet: unknown content '"+h+"'"),g.content[h]=l;p=a.styles;for(j in p)l=p[j],g.style(j,l);q=a.containers;for(f in q)if(i=q[f],e(g.containers.hasOwnProperty(f),"error while deserializing snippet: unknown container "+f),i)for(e($.isArray(i),"error while deserializing snippet: container is not array "+f),m=0,n=i.length;n>m;m++)c=i[m],g.append(f,d.fromJson(c,b));return g}},{"../configuration/defaults":3,"../modules/guid":18,"../modules/logging/assert":19,"../modules/logging/log":20,"../modules/serialization":22,"./snippet_container":33}],35:[function(a,b){var c,d,e,f,g,h=[].slice;g=a("../modules/logging/assert"),d=a("./snippet_container"),c=a("./snippet_array"),e=a("./snippet_model"),b.exports=f=function(){function a(a){var b,c;c=null!=a?a:{},b=c.content,this.design=c.design,g(null!=this.design,"Error instantiating SnippetTree: design param is misssing."),this.root=new d({isRoot:!0}),null!=b&&this.fromJson(b,this.design),this.root.snippetTree=this,this.initializeEvents()}return a.prototype.prepend=function(a){return a=this.getSnippet(a),null!=a&&this.root.prepend(a),this},a.prototype.append=function(a){return a=this.getSnippet(a),null!=a&&this.root.append(a),this},a.prototype.getSnippet=function(a){return"string"==typeof a?this.createModel(a):a},a.prototype.createModel=function(a){var b;return b=this.getTemplate(a),b?b.createModel():void 0},a.prototype.createSnippet=function(){return this.createModel.apply(this,arguments)},a.prototype.getTemplate=function(a){var b;return b=this.design.get(a),g(b,"Could not find template "+a),b},a.prototype.initializeEvents=function(){return this.snippetAdded=$.Callbacks(),this.snippetRemoved=$.Callbacks(),this.snippetMoved=$.Callbacks(),this.snippetContentChanged=$.Callbacks(),this.snippetHtmlChanged=$.Callbacks(),this.snippetSettingsChanged=$.Callbacks(),this.changed=$.Callbacks()},a.prototype.each=function(a){return this.root.each(a)},a.prototype.eachContainer=function(a){return this.root.eachContainer(a)},a.prototype.first=function(){return this.root.first},a.prototype.all=function(a){return this.root.all(a)},a.prototype.find=function(a){var b;return"string"==typeof a?(b=[],this.each(function(c){return c.identifier===a||c.template.id===a?b.push(c):void 0}),new c(b)):new c},a.prototype.detach=function(){var a;return this.root.snippetTree=void 0,this.each(function(a){return a.snippetTree=void 0}),a=this.root,this.root=new d({isRoot:!0}),a},a.prototype.print=function(){var a,b,c;return b="SnippetTree\n-----------\n",a=function(a,c){return null==c&&(c=0),b+=""+Array(c+1).join(" ")+a+"\n"},c=function(b,d){var e,f,g,h;null==d&&(d=0),g=b.template,a("- "+g.title+" ("+g.identifier+")",d),h=b.containers;for(e in h)f=h[e],a(""+e+":",d+2),f.first&&c(f.first,d+4);return b.next?c(b.next,d):void 0},this.root.first&&c(this.root.first),b},a.prototype.attachingSnippet=function(a,b){return a.snippetTree===this?(b(),this.fireEvent("snippetMoved",a)):(null!=a.snippetTree&&a.snippetContainer.detachSnippet(a),a.descendantsAndSelf(function(a){return function(b){return b.snippetTree=a}}(this)),b(),this.fireEvent("snippetAdded",a))},a.prototype.fireEvent=function(){var a,b;return b=arguments[0],a=2<=arguments.length?h.call(arguments,1):[],this[b].fire.apply(b,a),this.changed.fire()},a.prototype.detachingSnippet=function(a,b){return g(a.snippetTree===this,"cannot remove snippet from another SnippetTree"),a.descendantsAndSelf(function(a){return a.snippetTree=void 0}),b(),this.fireEvent("snippetRemoved",a)},a.prototype.contentChanging=function(a){return this.fireEvent("snippetContentChanged",a)},a.prototype.htmlChanging=function(a){return this.fireEvent("snippetHtmlChanged",a)},a.prototype.printJson=function(){return words.readableJson(this.toJson())},a.prototype.serialize=function(){var a,b,c;return a={},a.content=[],a.design={name:this.design.namespace},b=function(a,b,c){var d;return d=a.toJson(),c.push(d),d},c=function(a,d,e){var f,g,h,i,j;i=b(a,d,e),j=a.containers;for(g in j)h=j[g],f=i.containers[h.name]=[],h.first&&c(h.first,d+1,f);return a.next?c(a.next,d,e):void 0},this.root.first&&c(this.root.first,0,a.content),a},a.prototype.toJson=function(){return this.serialize()},a.prototype.fromJson=function(a,b){var c,d,f,g,h;if(this.root.snippetTree=void 0,a.content)for(h=a.content,f=0,g=h.length;g>f;f++)d=h[f],c=e.fromJson(d,b),this.root.append(c);return this.root.snippetTree=this,this.root.each(function(a){return function(b){return b.snippetTree=a}}(this))},a}()},{"../modules/logging/assert":19,"./snippet_array":32,"./snippet_container":33,"./snippet_model":34}],36:[function(a,b){var c,d;d=a("../configuration/defaults"),b.exports=c=function(){function a(a){var b;b=a.name,this.type=a.type,this.elem=a.elem,this.name=b||d.directives[this.type].defaultName,this.config=d.directives[this.type],this.optional=!1}return a.prototype.renderedAttr=function(){return this.config.renderedAttr},a.prototype.isElementDirective=function(){return this.config.elementDirective},a.prototype.clone=function(){var b;return b=new a({name:this.name,type:this.type}),b.optional=this.optional,b},a}()},{"../configuration/defaults":3}],37:[function(a,b){var c,d,e,f;e=a("../modules/logging/assert"),f=a("../configuration/defaults"),c=a("./directive"),b.exports=d=function(){function a(a){this.all=null!=a?a:{},this.length=0}return a.prototype.add=function(a){var b;return this.assertNameNotUsed(a),this[this.length]=a,a.index=this.length,this.length+=1,this.all[a.name]=a,this[b=a.type]||(this[b]=[]),this[a.type].push(a)},a.prototype.next=function(a){var b;return a instanceof c&&(b=a),b||(b=this.all[a]),this[b.index+=1]},a.prototype.nextOfType=function(a){var b,d;for(a instanceof c&&(b=a),b||(b=this.all[a]),d=b.type;b=this.next(b);)if(b.type===d)return b},a.prototype.get=function(a){return this.all[a]},a.prototype.$getElem=function(a){return $(this.all[a].elem)},a.prototype.count=function(a){var b;return a?null!=(b=this[a])?b.length:void 0:this.length},a.prototype.each=function(a){var b,c,d,e;for(e=[],c=0,d=this.length;d>c;c++)b=this[c],e.push(a(b));return e},a.prototype.clone=function(){var b;return b=new a,this.each(function(a){return b.add(a.clone())}),b},a.prototype.assertAllLinked=function(){return this.each(function(a){return a.elem?void 0:!1}),!0},a.prototype.assertNameNotUsed=function(a){return e(a&&!this.all[a.name],""+a.type+" Template parsing error:\n"+f.directives[a.type].renderedAttr+'="'+a.name+'".\n"'+a.name+'" is a duplicate name.')},a}()},{"../configuration/defaults":3,"../modules/logging/assert":19,"./directive":36}],38:[function(a,b){var c,d;d=a("../configuration/defaults"),c=a("./directive"),b.exports=function(){var a;return a=/^(x-|data-)/,{parse:function(a){var b,c;return b=void 0,c=[],this.parseDirectives(a,function(a){return a.isElementDirective()?b=a:c.push(a)}),b&&this.applyModifications(b,c),b},parseDirectives:function(b,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;for(j=[],q=b.attributes,m=0,o=q.length;o>m;m++)f=q[m],g=f.name,k=g.replace(a,""),(l=d.templateAttrLookup[k])&&j.push({attributeName:g,directive:new c({name:f.value,type:l,elem:b})});for(r=[],n=0,p=j.length;p>n;n++)h=j[n],i=h.directive,this.rewriteAttribute(i,h.attributeName),r.push(e(i));return r},applyModifications:function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)switch(c=b[d],c.type){case"optional":f.push(a.optional=!0);break;default:f.push(void 0)}return f},rewriteAttribute:function(a,b){return a.isElementDirective()?b!==a.renderedAttr()?this.normalizeAttribute(a,b):a.name?void 0:this.normalizeAttribute(a):this.removeAttribute(a,b)},normalizeAttribute:function(a,b){var c;return c=a.elem,b&&this.removeAttribute(a,b),c.setAttribute(a.renderedAttr(),a.name)},removeAttribute:function(a,b){return a.elem.removeAttribute(b)}}}()},{"../configuration/defaults":3,"./directive":36}],39:[function(a,b){var c,d;c=a("../configuration/defaults"),b.exports=d=function(){var a;return a=/^(x-|data-)/,{link:function(b,d){var e,f,g,h,i,j,k;for(k=b.attributes,i=0,j=k.length;j>i;i++)e=k[i],g=e.name.replace(a,""),(h=c.templateAttrLookup[g])&&(f=d.get(e.value),f.elem=b);return void 0}}}()},{"../configuration/defaults":3}],40:[function(a,b){var c,d;d=a("../configuration/defaults"),b.exports=c=function(){function a(a){this.root=this._next=a,this.containerAttr=d.directives.container.renderedAttr}return a.prototype.current=null,a.prototype.hasNext=function(){return!!this._next},a.prototype.next=function(){var a,b,c;if(b=this.current=this._next,a=c=void 0,this.current)if(a=b.firstChild,a&&1===b.nodeType&&!b.hasAttribute(this.containerAttr))this._next=a;else{for(c=null;b!==this.root&&!(c=b.nextSibling);)b=b.parentNode;this._next=c}return this.current},a.prototype.nextElement=function(){for(;this.next()&&1!==this.current.nodeType;);return this.current},a.prototype.detach=function(){return this.current=this._next=this.root=null},a}()},{"../configuration/defaults":3}],41:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m;l=a("../modules/logging/log"),h=a("../modules/logging/assert"),m=a("../modules/words"),i=a("../configuration/defaults"),d=a("./directive_iterator"),c=a("./directive_collection"),j=a("./directive_compiler"),k=a("./directive_finder"),e=a("../snippet_tree/snippet_model"),f=a("../rendering/snippet_view"),b.exports=g=function(){function a(b){var c,d,e,f,g,i,j;i=null!=b?b:{},c=i.html,this.namespace=i.namespace,this.id=i.id,d=i.identifier,f=i.title,e=i.styles,g=i.weight,h(c,"Template: param html missing"),d&&(j=a.parseIdentifier(d),this.namespace=j.namespace,this.id=j.id),this.identifier=this.namespace&&this.id?""+this.namespace+"."+this.id:void 0,this.$template=$(this.pruneHtml(c)).wrap("<div>"),this.$wrap=this.$template.parent(),this.title=f||m.humanize(this.id),this.styles=e||{},this.weight=g,this.defaults={},this.parseTemplate()}return a.prototype.createModel=function(){return new e({template:this})},a.prototype.createView=function(a,b){var c,d,e;return a||(a=this.createModel()),c=this.$template.clone(),d=this.linkDirectives(c[0]),e=new f({model:a,$html:c,directives:d,isReadOnly:b})},a.prototype.pruneHtml=function(a){return a=$(a).filter(function(){return 8!==this.nodeType}),h(1===a.length,'Templates must contain one root element. The Template "'+this.identifier+'" contains '+a.length),a},a.prototype.parseTemplate=function(){var a;return a=this.$template[0],this.directives=this.compileDirectives(a),this.directives.each(function(a){return function(b){switch(b.type){case"editable":return a.formatEditable(b.name,b.elem);case"container":return a.formatContainer(b.name,b.elem);case"html":return a.formatHtml(b.name,b.elem)}}}(this))},a.prototype.compileDirectives=function(a){var b,e,f;for(f=new d(a),e=new c;a=f.nextElement();)b=j.parse(a),b&&e.add(b);return e},a.prototype.linkDirectives=function(a){var b,c;for(b=new d(a),c=this.directives.clone();a=b.nextElement();)k.link(a,c);return c},a.prototype.formatEditable=function(a,b){var c,d;return c=$(b),c.addClass(i.css.editable),d=m.trim(b.innerHTML),d&&(this.defaults[a]=d),b.innerHTML=""},a.prototype.formatContainer=function(a,b){return b.innerHTML=""},a.prototype.formatHtml=function(a,b){var c;return c=m.trim(b.innerHTML),c&&(this.defaults[a]=c),b.innerHTML=""},a.prototype.printDoc=function(){var a;return a={identifier:this.identifier},m.readableJson(a)},a}(),g.parseIdentifier=function(a){var b;if(a)return b=a.split("."),1===b.length?{namespace:void 0,id:b[0]}:2===b.length?{namespace:b[0],id:b[1]}:l.error("could not parse snippet template identifier: "+a)}},{"../configuration/defaults":3,"../modules/logging/assert":19,"../modules/logging/log":20,"../modules/words":23,"../rendering/snippet_view":25,"../snippet_tree/snippet_model":34,"./directive_collection":37,"./directive_compiler":38,"./directive_finder":39,"./directive_iterator":40}]},{},[2]);